<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>flex Payroll - 사업장 및 사회보험 관리</title>
    <!-- Tailwind CSS (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome Icons (CDN) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .toggle-checkbox:checked { right: 0; border-color: #2563EB; }
        .toggle-checkbox:checked + .toggle-label { background-color: #2563EB; }
        .toggle-checkbox:checked + .toggle-label:after { transform: translateX(100%); border-color: white; }
        .toggle-label:after { content: ''; position: absolute; top: 2px; left: 2px; width: 16px; height: 16px; background-color: white; border-radius: 50%; transition: transform 0.2s ease-in-out; box-shadow: 0 1px 2px rgba(0,0,0,0.2); }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="min-h-screen bg-gray-50 text-gray-800 font-sans flex flex-col relative">

    <!-- Top Navigation -->
    <header class="bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between sticky top-0 z-10">
        <div class="flex items-center space-x-2">
            <div class="w-8 h-8 bg-blue-600 rounded-md flex items-center justify-center text-white font-bold">f</div>
            <span class="text-xl font-bold">Payroll <span class="text-gray-400 font-normal ml-1">사업장 및 사회보험 관리</span></span>
        </div>
        <div class="flex space-x-1 bg-gray-100 p-1 rounded-lg">
            <button onclick="switchTab('company')" id="btn-tab-company" class="tab-btn flex items-center px-4 py-2 rounded-md text-sm font-medium transition-all text-gray-500 hover:text-gray-800 hover:bg-gray-200">
                <i class="fa-regular fa-building mr-2"></i> 회사 정보 (마스터)
            </button>
            <button onclick="switchTab('workplace')" id="btn-tab-workplace" class="tab-btn flex items-center px-4 py-2 rounded-md text-sm font-medium transition-all text-gray-500 hover:text-gray-800 hover:bg-gray-200">
                <i class="fa-solid fa-briefcase mr-2"></i> 사업장 정보
            </button>
            <button onclick="switchTab('member')" id="btn-tab-member" class="tab-btn flex items-center px-4 py-2 rounded-md text-sm font-bold transition-all bg-white text-blue-700 shadow-sm border border-gray-200">
                <i class="fa-regular fa-user mr-2"></i> 구성원 사회보험
            </button>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="flex-1 p-8 overflow-y-auto">
        <div class="max-w-5xl mx-auto">
            
            <!-- ========================================== -->
            <!-- 1. 회사 정보 탭 (Company Info) -->
            <!-- ========================================== -->
            <div id="tab-company" class="hidden space-y-6">
                <div class="bg-blue-50 border border-blue-200 p-4 rounded-lg flex items-start">
                    <i class="fa-solid fa-circle-info text-blue-500 mt-1 mr-3"></i>
                    <p class="text-sm text-blue-800 leading-relaxed">
                        <b>안내:</b> 기존 '정산 설정' 메뉴에 있던 <b>원천징수의무자 정보</b>가 이곳 회사 정보로 통합되었습니다.<br>이곳에서 입력한 마스터 데이터는 하위 사업장 생성 시 세무/회계 기본값으로 자동 연동됩니다.
                    </p>
                </div>

                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-8">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-900">회사 기본 정보</h2>
                    </div>
                    
                    <!-- 핵심 분기점 -->
                    <div class="mb-8 p-6 rounded-lg border border-gray-200 bg-gray-50">
                        <label class="block text-sm font-bold text-gray-700 mb-3">법인/개인 구분 <span class="text-red-500">*</span></label>
                        <div class="flex space-x-4">
                            <label id="lbl-corp-corporate" class="flex items-center p-3 border rounded-md cursor-pointer flex-1 justify-center transition-colors bg-blue-600 text-white border-blue-600 shadow-sm">
                                <input type="radio" name="corpType" value="corporate" checked onchange="toggleCorpType('corporate')" class="hidden" />
                                법인 사업자
                            </label>
                            <label id="lbl-corp-individual" class="flex items-center p-3 border rounded-md cursor-pointer flex-1 justify-center transition-colors bg-white text-gray-600 hover:bg-gray-50 border-gray-300">
                                <input type="radio" name="corpType" value="individual" onchange="toggleCorpType('individual')" class="hidden" />
                                개인 사업자
                            </label>
                        </div>
                    </div>

                    <!-- 1-1. 공통 필수 정보 -->
                    <div class="grid grid-cols-2 gap-x-6 gap-y-5 mb-8">
                        <div><label class="block text-sm font-bold text-gray-700 mb-1.5">회사명(상호) <span class="text-red-500">*</span></label><input type="text" placeholder="주식회사 플렉스" class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500"></div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1.5">사업자등록번호 <span class="text-red-500">*</span></label>
                            <div class="flex">
                                <input type="text" placeholder="000-00-00000" class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 flex-1 rounded-r-none border-r-0">
                                <button onclick="openModal('modal-api-verify')" class="bg-gray-100 border border-gray-300 text-gray-700 px-4 py-2 rounded-r-md text-sm font-bold hover:bg-gray-200 transition-colors">휴폐업 조회</button>
                            </div>
                        </div>
                        <div><label class="block text-sm font-bold text-gray-700 mb-1.5">대표자 성명 <span class="text-red-500">*</span></label><input type="text" placeholder="홍길동" class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500"></div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1.5">대표자 내/외국인 구분 <span class="text-red-500">*</span></label>
                            <select class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 bg-white">
                                <option>내국인</option><option>외국인</option>
                            </select>
                        </div>
                        <div class="col-span-2"><label class="block text-sm font-bold text-gray-700 mb-1.5">본점 소재지 (주소) <span class="text-red-500">*</span></label><input type="text" placeholder="우편번호 검색" class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 mb-2"><input type="text" placeholder="상세 주소 입력" class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500"></div>
                        <div><label class="block text-sm font-bold text-gray-700 mb-1.5">업종코드 <span class="text-red-500">*</span></label><input type="text" placeholder="예: 722000" class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500"></div>
                        <div><label class="block text-sm font-bold text-gray-700 mb-1.5">업태 / 종목 <span class="text-red-500">*</span></label><input type="text" placeholder="예: 서비스업 / 소프트웨어개발" class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500"></div>
                    </div>

                    <!-- 1-2. 조건부 렌더링 영역: 법인/개인 -->
                    <div class="border-t border-gray-200 pt-6 mb-8">
                        <h3 class="text-sm font-bold text-blue-600 mb-4 flex items-center"><i class="fa-solid fa-building mr-2"></i><span id="txt-corp-title">법인 사업자 전용 정보</span></h3>
                        
                        <!-- 법인 -->
                        <div id="fields-corporate" class="grid grid-cols-2 gap-6 block">
                            <div><label class="block text-sm font-bold text-gray-700 mb-1.5">법인등록번호 <span class="text-red-500">*</span></label><input type="text" placeholder="000000-0000000" class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500"></div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1.5">법인구분 <span class="text-red-500">*</span></label>
                                <select class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 bg-white">
                                    <option value="">선택해주세요</option><option>영리법인</option><option>비영리법인(국가/지자체)</option><option>기타</option>
                                </select>
                            </div>
                        </div>

                        <!-- 개인 -->
                        <div id="fields-individual" class="hidden space-y-6">
                            <div class="grid grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-bold text-gray-700 mb-1.5">과세유형 <span class="text-red-500">*</span></label>
                                    <select class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm bg-white"><option>일반과세자</option><option>간이과세자</option><option>면세사업자</option></select>
                                </div>
                                <div><label class="block text-sm font-bold text-gray-700 mb-1.5">소득구분</label><input type="text" placeholder="예: 사업소득" class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm"></div>
                                <div><label class="block text-sm font-bold text-gray-700 mb-1.5">대표자 구분</label><input type="text" class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm"></div>
                                <div>
                                    <div class="flex items-center justify-between border border-gray-300 p-3 rounded-md mt-6 bg-white h-[38px]">
                                        <span class="text-sm font-bold text-gray-700">공동사업장 여부</span>
                                        <div class="relative inline-block w-10 mr-2 align-middle select-none">
                                            <input type="checkbox" id="toggle-joint" onchange="toggleJointBusiness()" class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer z-10 opacity-0"/>
                                            <label for="toggle-joint" class="toggle-label block overflow-hidden h-5 rounded-full bg-gray-300 cursor-pointer relative"></label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- 공동사업장 ON 일때 노출 -->
                            <div id="fields-joint-business" class="hidden bg-gray-50 p-4 rounded-lg border border-gray-200 grid grid-cols-2 gap-4">
                                <div class="col-span-2 text-xs font-bold text-gray-500 mb-1"><i class="fa-solid fa-link mr-1"></i> 공동사업장 세무 연동 정보</div>
                                <div><label class="block text-sm font-semibold text-gray-700 mb-1.5">주된 소득자 주민번호 <span class="text-red-500">*</span></label><input type="text" placeholder="000000-0000000" class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm"></div>
                                <div><label class="block text-sm font-semibold text-gray-700 mb-1.5">주된 소득자 구분 <span class="text-red-500">*</span></label><input type="text" class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm"></div>
                            </div>
                        </div>
                    </div>

                    <!-- 1-3. 시각적 위계 낮춤: 세무/회계 및 부가 정보 (아코디언) -->
                    <div class="border-t border-gray-200 pt-2">
                        <button onclick="toggleAccordion('acc-tax', 'icon-tax')" class="flex items-center justify-between w-full py-4 text-left hover:bg-gray-50 transition-colors rounded-md px-2">
                            <span class="font-bold text-gray-800"><i class="fa-solid fa-calculator text-gray-400 mr-2"></i> 세무/회계 및 기타 부가 정보</span>
                            <i id="icon-tax" class="fa-solid fa-chevron-down text-gray-400"></i>
                        </button>
                        
                        <div id="acc-tax" class="hidden mt-2 p-6 bg-gray-50 rounded-lg border border-gray-200 space-y-8">
                            <!-- 세무/회계 영역 -->
                            <div>
                                <h4 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-4">세무/회계 마스터 설정</h4>
                                <div class="grid grid-cols-3 gap-4">
                                    <div><label class="block text-sm font-semibold text-gray-700 mb-1">사업장 관할 세무서</label><input type="text" placeholder="예: 역삼세무서" class="w-full border border-gray-300 rounded px-3 py-2 text-sm"></div>
                                    <div><label class="block text-sm font-semibold text-gray-700 mb-1">지방세 법정동 코드</label><input type="text" class="w-full border border-gray-300 rounded px-3 py-2 text-sm"></div>
                                    <div><label class="block text-sm font-semibold text-gray-700 mb-1">지방세 행정동 코드</label><input type="text" class="w-full border border-gray-300 rounded px-3 py-2 text-sm"></div>
                                    <div><label class="block text-sm font-semibold text-gray-700 mb-1">정상사업기간 (회계)</label><input type="date" class="w-full border border-gray-300 rounded px-3 py-2 text-sm"></div>
                                    <div class="flex items-center justify-between border border-gray-300 px-3 py-2 rounded bg-white"><span class="text-sm font-medium">중소기업 여부</span><input type="checkbox" class="w-4 h-4 text-blue-600 rounded"></div>
                                    <div class="flex items-center justify-between border border-gray-300 px-3 py-2 rounded bg-white"><span class="text-sm font-medium">주류매매업 여부</span><input type="checkbox" class="w-4 h-4 text-blue-600 rounded"></div>
                                    <div class="col-span-3"><label class="block text-sm font-semibold text-gray-700 mb-1">국세환급금 계좌</label><div class="flex space-x-2"><select class="border border-gray-300 rounded px-3 py-2 text-sm w-1/3 bg-white"><option>은행 선택</option></select><input type="text" placeholder="계좌번호" class="w-full border border-gray-300 rounded px-3 py-2 text-sm"><input type="text" placeholder="예금주" class="w-1/3 border border-gray-300 rounded px-3 py-2 text-sm"></div></div>
                                </div>
                            </div>
                            <!-- 연락처 및 글로벌 -->
                            <div class="border-t border-gray-200 pt-6">
                                <h4 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-4">연락망 및 글로벌 정보</h4>
                                <div class="grid grid-cols-2 gap-4">
                                    <div><label class="block text-sm font-semibold text-gray-700 mb-1">대표 전화번호</label><input type="text" placeholder="02-000-0000" class="w-full border border-gray-300 rounded px-3 py-2 text-sm"></div>
                                    <div><label class="block text-sm font-semibold text-gray-700 mb-1">팩스 번호</label><input type="text" class="w-full border border-gray-300 rounded px-3 py-2 text-sm"></div>
                                    <div><label class="block text-sm font-semibold text-gray-700 mb-1">영문 회사명</label><input type="text" placeholder="flex Inc." class="w-full border border-gray-300 rounded px-3 py-2 text-sm"></div>
                                    <div><label class="block text-sm font-semibold text-gray-700 mb-1">영문 대표자명</label><input type="text" class="w-full border border-gray-300 rounded px-3 py-2 text-sm"></div>
                                    <div class="col-span-2"><label class="block text-sm font-semibold text-gray-700 mb-1">영문 주소</label><input type="text" class="w-full border border-gray-300 rounded px-3 py-2 text-sm"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========================================== -->
            <!-- 2. 사업장 정보 탭 (Workplace Info) -->
            <!-- ========================================== -->
            <div id="tab-workplace" class="hidden space-y-6">
                <div class="bg-blue-50 border border-blue-200 p-4 rounded-lg flex items-start">
                    <i class="fa-solid fa-circle-info text-blue-500 mt-1 mr-3"></i>
                    <p class="text-sm text-blue-800 leading-relaxed">
                        <b>안내:</b> 기존 '사회보험 신고 정보' 메뉴가 이곳 사업장 관리로 통합되었습니다.<br>사업장(지점/공장 등) 단위로 <b>4대보험 관리번호 및 특이사항(일자리, 플랫폼 등)</b>을 독립적으로 세팅할 수 있습니다.
                    </p>
                </div>

                <div class="flex justify-between items-center mb-4 mt-2">
                    <h2 class="text-2xl font-bold">사업장 목록</h2>
                    <button onclick="openModal('modal-add-workplace')" class="bg-gray-800 text-white px-4 py-2 rounded-md font-bold text-sm hover:bg-gray-900 transition-colors flex items-center shadow-sm">
                        <i class="fa-solid fa-plus mr-1"></i> 신규 사업장 등록
                    </button>
                </div>
        
                <!-- 등록된 사업장 목록 카드 뷰 -->
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="bg-white border-2 border-blue-600 rounded-xl p-5 shadow-sm relative">
                        <span class="absolute top-4 right-4 bg-blue-100 text-blue-800 text-xs font-bold px-2 py-1 rounded">본점 (대표)</span>
                        <h3 class="text-lg font-bold mb-1">주식회사 플렉스 (강남 본사)</h3>
                        <p class="text-sm text-gray-500 mb-4">사업자번호: 123-45-67890</p>
                        <div class="text-xs text-gray-600 bg-gray-50 p-3 rounded border space-y-1.5">
                            <p class="flex justify-between"><span class="font-bold text-gray-500">국민/건강 관리번호</span> <span class="font-medium text-gray-900">12345678900</span></p>
                            <p class="flex justify-between"><span class="font-bold text-gray-500">고용/산재 관리번호</span> <span class="font-medium text-gray-900">12345678900</span></p>
                        </div>
                    </div>
                    <div class="bg-gray-50 border border-gray-200 border-dashed rounded-xl p-5 hover:border-blue-400 hover:bg-blue-50 transition-colors flex flex-col items-center justify-center text-gray-500 cursor-pointer" onclick="openModal('modal-add-workplace')">
                        <i class="fa-solid fa-circle-plus text-3xl mb-2 text-gray-400"></i>
                        <span class="font-bold">새로운 지점/공장 추가</span>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-8 opacity-50 pointer-events-none relative">
                    <div class="absolute inset-0 bg-white bg-opacity-40 z-10 flex items-center justify-center">
                        <span class="bg-gray-800 text-white px-4 py-2 rounded shadow-lg text-sm font-medium"><i class="fa-solid fa-hand-pointer mr-2"></i>목록에서 사업장을 선택하거나 추가해주세요.</span>
                    </div>
                    <div class="grid grid-cols-2 gap-6">
                        <div><label class="block text-sm font-bold text-gray-300 mb-1.5">사업장명</label><input disabled class="w-full border border-gray-200 rounded-md px-3 py-2 bg-gray-50"></div>
                        <div><label class="block text-sm font-bold text-gray-300 mb-1.5">사업자등록번호</label><input disabled class="w-full border border-gray-200 rounded-md px-3 py-2 bg-gray-50"></div>
                    </div>
                </div>
            </div>

            <!-- ========================================== -->
            <!-- 3. 구성원 정보 (Member Insurance & Timeline & Status) -->
            <!-- ========================================== -->
            <div id="tab-member" class="hidden gap-6 h-[800px]">
                
                <!-- Left: 코어 데이터 (Single Source of Truth) -->
                <div class="w-1/3 bg-white rounded-xl shadow-sm border border-gray-200 p-6 flex flex-col relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-2 bg-blue-600"></div>
                    <div class="flex items-center space-x-4 mb-6 pt-2">
                        <div class="w-16 h-16 bg-gray-100 border border-gray-200 rounded-full flex items-center justify-center text-gray-400">
                            <i class="fa-solid fa-user text-3xl"></i>
                        </div>
                        <div>
                            <h2 class="text-xl font-bold">이규리 <span class="text-sm font-normal text-gray-500 ml-1">UX Designer</span></h2>
                            <p class="text-sm text-gray-500 font-medium">강남 본사 소속</p>
                        </div>
                    </div>
            
                    <div class="space-y-4 flex-1 overflow-y-auto pr-2">
                        <!-- 기본 인적 정보 -->
                        <div class="p-4 bg-gray-50 rounded-lg border border-gray-100 relative group">
                            <span class="absolute top-2 right-2 text-[10px] bg-white border border-gray-200 text-gray-500 px-2 py-1 rounded uppercase tracking-wider shadow-sm group-hover:bg-gray-800 group-hover:text-white transition-colors">인사 코어 연동</span>
                            <h3 class="text-sm font-bold text-gray-800 mb-3 border-b pb-2">기본 인적 & 계약 정보</h3>
                            <div class="grid grid-cols-2 gap-y-3">
                                <div><span class="block text-xs text-gray-500">주민등록번호</span><span class="block text-sm font-bold text-gray-900">900114-2XXXXXX</span></div>
                                <div><span class="block text-xs text-gray-500">국적/비자</span><span class="block text-sm font-bold text-gray-900">내국인</span></div>
                                <div><span class="block text-xs text-gray-500">계약 형태</span><span class="block text-sm font-bold text-gray-900">정규직</span></div>
                                <div><span class="block text-xs text-gray-500">주소정근로시간</span><span class="block text-sm font-bold text-gray-900">40 시간</span></div>
                            </div>
                        </div>
            
                        <!-- 급여/세무 기초 -->
                        <div class="p-4 bg-gray-50 rounded-lg border border-gray-100 relative group">
                            <span class="absolute top-2 right-2 text-[10px] bg-white border border-gray-200 text-gray-500 px-2 py-1 rounded uppercase tracking-wider shadow-sm group-hover:bg-gray-800 group-hover:text-white transition-colors">급여 코어 연동</span>
                            <h3 class="text-sm font-bold text-gray-800 mb-3 border-b pb-2">급여/세무 설정</h3>
                            <div class="grid grid-cols-2 gap-y-3">
                                <div><span class="block text-xs text-gray-500">현재 보수월액</span><span class="block text-sm font-bold text-blue-600">5,000,000 원</span></div>
                                <div><span class="block text-xs text-gray-500">원천징수세율</span><span class="block text-sm font-bold text-gray-900">100%</span></div>
                            </div>
                        </div>
            
                        <!-- 가족 및 피부양자 -->
                        <div class="p-4 bg-blue-50/50 rounded-lg border border-blue-100">
                            <div class="flex justify-between items-center mb-3">
                                <h3 class="text-sm font-bold text-gray-800">가족 및 피부양자 (원장)</h3>
                                <button onclick="openModal('modal-family')" class="text-xs bg-white border border-blue-200 text-blue-700 px-2 py-1 rounded hover:bg-blue-600 hover:text-white transition-colors font-bold">
                                    <i class="fa-solid fa-gear mr-1"></i> 관리
                                </button>
                            </div>
                            <div class="text-sm text-gray-600 bg-white p-3 border border-gray-200 rounded shadow-sm hover:border-blue-400 transition-colors cursor-pointer" onclick="openModal('modal-family')">
                                <div class="flex justify-between items-center">
                                    <div class="flex items-center">
                                        <i class="fa-solid fa-child text-gray-400 mr-2"></i>
                                        <span class="font-bold text-gray-800">이하은 <span class="text-gray-500 text-xs ml-1 font-normal">(자녀)</span></span>
                                    </div>
                                    <span class="text-[10px] bg-blue-100 text-blue-800 px-2 py-0.5 rounded font-bold">피부양자 ON</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            
                <!-- Right: 자격 변동 타임라인 OR 현재 자격 상세 (Sub-tabs) -->
                <div class="w-2/3 bg-white rounded-xl shadow-sm border border-gray-200 p-0 flex flex-col relative overflow-hidden">
                    
                    <!-- Header with Actions -->
                    <div class="px-6 py-4 border-b flex justify-between items-center bg-white z-10">
                        <div class="flex space-x-6">
                            <button onclick="switchMemberSubTab('status')" id="sub-tab-status" class="pb-3 border-b-2 font-bold text-blue-600 border-blue-600 transition-colors pt-3">
                                <i class="fa-solid fa-id-card mr-1.5"></i> 현재 자격 상세
                            </button>
                            <button onclick="switchMemberSubTab('timeline')" id="sub-tab-timeline" class="pb-3 border-b-2 font-medium text-gray-500 border-transparent hover:text-gray-800 transition-colors pt-3">
                                <i class="fa-solid fa-clock-rotate-left mr-1.5"></i> 자격 변동 타임라인
                            </button>
                        </div>
                        <button onclick="openModal('modal-report-change')" class="bg-gray-800 text-white px-4 py-2 rounded-md font-bold text-sm hover:bg-gray-900 transition-colors flex items-center shadow-sm">
                            <i class="fa-solid fa-bolt mr-2 text-yellow-300"></i> 변동사항 신고
                        </button>
                    </div>
            
                    <!-- Sub-Tab 1: 현재 자격 상세 (Static Field View) -->
                    <div id="member-view-status" class="flex-1 overflow-y-auto p-6 bg-gray-50">
                        <div class="mb-4 bg-white p-4 border border-gray-200 rounded-lg flex items-center justify-between shadow-sm">
                            <div class="flex flex-col">
                                <span class="text-xs text-gray-500 font-bold mb-1">소속 사업장(지점) 기준</span>
                                <span class="text-sm font-bold text-gray-900"><i class="fa-solid fa-building text-blue-500 mr-1.5"></i> 주식회사 플렉스 (강남 본사)</span>
                            </div>
                            <span class="bg-green-100 text-green-800 text-xs font-bold px-3 py-1 rounded-full border border-green-200"><i class="fa-solid fa-circle text-[8px] mr-1"></i>정상 취득 상태</span>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <!-- 국민연금 카드 -->
                            <div class="bg-white border border-gray-200 rounded-lg p-5 shadow-sm hover:border-blue-300 transition-colors">
                                <div class="flex items-center mb-4">
                                    <div class="w-8 h-8 rounded-full bg-yellow-100 flex items-center justify-center mr-3 text-yellow-600"><i class="fa-solid fa-piggy-bank"></i></div>
                                    <h3 class="font-bold text-gray-900 text-lg">국민연금</h3>
                                </div>
                                <div class="space-y-3 text-sm">
                                    <div class="flex flex-col"><span class="text-xs text-gray-500 mb-0.5 font-semibold">사업장 관리번호 (EDI 입력용)</span><span class="font-mono font-bold text-gray-900 bg-gray-100 px-2 py-1 rounded inline-block w-max">12345678900</span></div>
                                    <div class="flex flex-col"><span class="text-xs text-gray-500 mb-0.5">자격 취득일</span><span class="font-medium text-gray-800">2023.01.15</span></div>
                                    <div class="flex flex-col"><span class="text-xs text-gray-500 mb-0.5">신고 소득월액</span><span class="font-bold text-blue-600">5,000,000 원</span></div>
                                </div>
                            </div>

                            <!-- 건강보험 카드 -->
                            <div class="bg-white border border-gray-200 rounded-lg p-5 shadow-sm hover:border-blue-300 transition-colors">
                                <div class="flex items-center mb-4">
                                    <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center mr-3 text-blue-600"><i class="fa-solid fa-heart-pulse"></i></div>
                                    <h3 class="font-bold text-gray-900 text-lg">건강보험</h3>
                                </div>
                                <div class="space-y-3 text-sm">
                                    <div class="flex flex-col"><span class="text-xs text-gray-500 mb-0.5 font-semibold">사업장 관리번호 (EDI 입력용)</span><span class="font-mono font-bold text-gray-900 bg-gray-100 px-2 py-1 rounded inline-block w-max">12345678900</span></div>
                                    <div class="flex flex-col"><span class="text-xs text-gray-500 mb-0.5">자격 취득일</span><span class="font-medium text-gray-800">2023.01.15</span></div>
                                    <div class="flex flex-col"><span class="text-xs text-gray-500 mb-0.5">신고 보수월액</span><span class="font-bold text-blue-600">5,000,000 원</span></div>
                                    <div class="flex flex-col"><span class="text-xs text-gray-500 mb-0.5">피부양자 여부</span><span class="font-medium text-gray-800">1명 등록됨 (자녀)</span></div>
                                </div>
                            </div>

                            <!-- 고용보험 카드 -->
                            <div class="bg-white border border-gray-200 rounded-lg p-5 shadow-sm hover:border-blue-300 transition-colors">
                                <div class="flex items-center mb-4">
                                    <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center mr-3 text-indigo-600"><i class="fa-solid fa-briefcase"></i></div>
                                    <h3 class="font-bold text-gray-900 text-lg">고용보험</h3>
                                </div>
                                <div class="space-y-3 text-sm">
                                    <div class="flex flex-col"><span class="text-xs text-gray-500 mb-0.5 font-semibold">사업장 관리번호 (EDI 입력용)</span><span class="font-mono font-bold text-gray-900 bg-blue-50 text-blue-800 border border-blue-100 px-2 py-1 rounded inline-block w-max">98765432100</span></div>
                                    <div class="flex flex-col"><span class="text-xs text-gray-500 mb-0.5">자격 취득일</span><span class="font-medium text-gray-800">2023.01.15</span></div>
                                    <div class="flex flex-col"><span class="text-xs text-gray-500 mb-0.5">신고 월평균보수</span><span class="font-bold text-blue-600">5,000,000 원</span></div>
                                    <div class="flex flex-col"><span class="text-xs text-gray-500 mb-0.5">직종 (고용산재 표준분류)</span><span class="font-medium text-gray-800">012 경영지원, 행정 관련</span></div>
                                </div>
                            </div>

                            <!-- 산재보험 카드 -->
                            <div class="bg-white border border-gray-200 rounded-lg p-5 shadow-sm hover:border-blue-300 transition-colors">
                                <div class="flex items-center mb-4">
                                    <div class="w-8 h-8 rounded-full bg-red-100 flex items-center justify-center mr-3 text-red-600"><i class="fa-solid fa-helmet-safety"></i></div>
                                    <h3 class="font-bold text-gray-900 text-lg">산재보험</h3>
                                </div>
                                <div class="space-y-3 text-sm">
                                    <div class="flex flex-col"><span class="text-xs text-gray-500 mb-0.5 font-semibold">사업장 관리번호 (EDI 입력용)</span><span class="font-mono font-bold text-gray-900 bg-blue-50 text-blue-800 border border-blue-100 px-2 py-1 rounded inline-block w-max">98765432100</span></div>
                                    <div class="flex flex-col"><span class="text-xs text-gray-500 mb-0.5">자격 취득일</span><span class="font-medium text-gray-800">2023.01.15</span></div>
                                    <div class="flex flex-col"><span class="text-xs text-gray-500 mb-0.5">신고 월평균보수</span><span class="font-bold text-blue-600">5,000,000 원</span></div>
                                    <div class="flex flex-col"><span class="text-xs text-gray-500 mb-0.5">1주 소정근로시간 / 계약직</span><span class="font-medium text-gray-800">40시간 / 해당없음</span></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sub-Tab 2: 자격 변동 타임라인 (Timeline View) -->
                    <div id="member-view-timeline" class="hidden flex-1 overflow-y-auto p-8 bg-gray-50/50">
                        <!-- Timeline Container -->
                        <div class="relative border-l-2 border-gray-200 ml-4 space-y-10 pb-8">
                            
                            <!-- Timeline 항목 3 (최근: 휴직) -->
                            <div class="relative pl-8">
                                <div class="absolute w-4 h-4 bg-blue-600 rounded-full -left-[9px] top-1 border-4 border-blue-100"></div>
                                <div class="flex items-center mb-2">
                                    <span class="text-sm font-black text-gray-900 w-24">2025.04.01</span>
                                    <span class="bg-blue-100 text-blue-800 text-xs px-2.5 py-1 rounded font-bold border border-blue-200">휴직 / 납부유예 신고</span>
                                </div>
                                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm relative hover:shadow-md transition-shadow">
                                    <div class="absolute top-5 right-5 text-xs text-gray-500 font-bold flex items-center bg-green-50 px-2 py-1 rounded border border-green-100"><i class="fa-solid fa-circle-check text-green-500 mr-1.5"></i> 공단 접수완료</div>
                                    <h4 class="font-bold text-gray-900 mb-5 text-lg">출산전후휴가 및 육아휴직 발생</h4>
                                    <div class="grid grid-cols-2 gap-x-6 gap-y-4 text-sm bg-gray-50 p-4 rounded-lg">
                                        <div class="flex flex-col"><span class="text-gray-500 text-xs mb-1 font-bold">휴직 구분</span><span class="text-gray-900 font-medium">산전후휴가 및 육아휴직 (01)</span></div>
                                        <div class="flex flex-col"><span class="text-gray-500 text-xs mb-1 font-bold">휴직 기간</span><span class="text-gray-900 font-medium">2025.04.01 ~ 2026.03.31</span></div>
                                        <div class="flex flex-col"><span class="text-gray-500 text-xs mb-1 font-bold">납부예외 신청</span><span class="text-gray-900 font-medium">국민연금, 건강보험</span></div>
                                        <div class="flex flex-col"><span class="text-gray-500 text-xs mb-1 font-bold">육아 특례</span><span class="text-blue-600 font-bold">6+6 부모동시사용 적용</span></div>
                                    </div>
                                    <div class="mt-5 pt-5 border-t border-gray-100 flex gap-2">
                                        <button onclick="openModal('modal-download', '납부예외신청서')" class="text-xs font-bold flex items-center text-gray-700 bg-white hover:bg-gray-50 border border-gray-300 px-4 py-2 rounded transition-colors shadow-sm"><i class="fa-solid fa-file-pdf text-red-500 mr-2 text-sm"></i>납부예외신청서</button>
                                        <button onclick="openModal('modal-download', '육아휴직확인서')" class="text-xs font-bold flex items-center text-gray-700 bg-white hover:bg-gray-50 border border-gray-300 px-4 py-2 rounded transition-colors shadow-sm"><i class="fa-solid fa-file-pdf text-red-500 mr-2 text-sm"></i>육아휴직확인서</button>
                                    </div>
                                </div>
                            </div>
            
                            <!-- Timeline 항목 2 (과거: 보수 변경) -->
                            <div class="relative pl-8 opacity-60 hover:opacity-100 transition-opacity">
                                <div class="absolute w-4 h-4 bg-gray-300 rounded-full -left-[9px] top-1 border-4 border-white"></div>
                                <div class="flex items-center mb-2">
                                    <span class="text-sm font-bold text-gray-500 w-24">2024.03.01</span>
                                    <span class="bg-gray-100 text-gray-600 text-xs px-2.5 py-1 rounded font-bold border border-gray-200">보수월액 변경</span>
                                </div>
                                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm relative">
                                    <h4 class="font-bold text-gray-900 mb-4">24년 연봉계약 갱신에 따른 변경</h4>
                                    <div class="grid grid-cols-2 gap-x-6 gap-y-4 text-sm border-l-2 border-gray-200 pl-4">
                                        <div class="flex flex-col"><span class="text-gray-400 text-xs mb-1">변경 사유</span><span class="text-gray-800 font-medium">임금 인상</span></div>
                                        <div class="flex flex-col"><span class="text-gray-400 text-xs mb-1">적용 연월</span><span class="text-gray-800 font-medium">2024년 3월</span></div>
                                        <div class="flex flex-col"><span class="text-gray-400 text-xs mb-1">기존 보수월액</span><span class="text-gray-500 line-through">4,500,000 원</span></div>
                                        <div class="flex flex-col"><span class="text-gray-400 text-xs mb-1">변경 보수월액</span><span class="text-gray-900 font-bold">5,000,000 원</span></div>
                                    </div>
                                </div>
                            </div>
            
                            <!-- Timeline 항목 1 (최초: 입사) -->
                            <div class="relative pl-8 opacity-60 hover:opacity-100 transition-opacity">
                                <div class="absolute w-4 h-4 bg-gray-300 rounded-full -left-[9px] top-1 border-4 border-white"></div>
                                <div class="flex items-center mb-2">
                                    <span class="text-sm font-bold text-gray-500 w-24">2023.01.15</span>
                                    <span class="bg-gray-100 text-gray-600 text-xs px-2.5 py-1 rounded font-bold border border-gray-200">자격 취득 (입사)</span>
                                </div>
                                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm relative">
                                    <h4 class="font-bold text-gray-900 mb-4">신규 입사 및 4대보험 가입</h4>
                                    <div class="grid grid-cols-2 gap-x-6 gap-y-4 text-sm border-l-2 border-gray-200 pl-4">
                                        <div class="flex flex-col"><span class="text-gray-400 text-xs mb-1">취득일</span><span class="text-gray-800 font-medium">2023.01.15</span></div>
                                        <div class="flex flex-col"><span class="text-gray-400 text-xs mb-1">공단 구분</span><span class="text-gray-800 font-medium">연금, 건강, 고용, 산재</span></div>
                                        <div class="flex flex-col"><span class="text-gray-400 text-xs mb-1">취득 보수월액</span><span class="text-gray-800 font-medium">4,500,000 원</span></div>
                                        <div class="flex flex-col"><span class="text-gray-400 text-xs mb-1">국민연금 납부</span><span class="text-gray-800 font-medium">취득월 미납부 (2)</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- ========================================== -->
    <!-- Modals Overlay / Container -->
    <!-- ========================================== -->
    <div id="modal-backdrop" class="fixed inset-0 bg-gray-900 bg-opacity-60 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm transition-opacity">
        
        <!-- 1. API 검증 완료 모달 -->
        <div id="modal-api-verify" class="modal-content hidden bg-white w-full max-w-sm rounded-xl shadow-2xl overflow-hidden transform scale-100">
            <div class="p-6 text-center">
                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4"><i class="fa-solid fa-check text-3xl text-green-500"></i></div>
                <h3 class="text-lg font-bold text-gray-900 mb-2">국세청 휴폐업 조회 완료</h3>
                <p class="text-sm text-gray-600">입력하신 사업자등록번호는 유효합니다.<br><span class="text-blue-600 font-bold mt-1 block">(정상 영업 상태)</span></p>
            </div>
            <div class="px-6 py-4 bg-gray-50 border-t flex justify-center">
                <button onclick="closeModal()" class="w-full bg-blue-600 text-white font-bold py-2.5 px-4 rounded-md hover:bg-blue-700 transition-colors">확인</button>
            </div>
        </div>

        <!-- 2. 신규 사업장 추가 폼 모달 (누락 필드 완벽 복구 및 추가) -->
        <div id="modal-add-workplace" class="modal-content hidden bg-white w-full max-w-3xl rounded-xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
            <div class="px-6 py-4 border-b flex justify-between items-center bg-gray-50">
                <h3 class="font-bold text-lg flex items-center"><i class="fa-solid fa-briefcase text-blue-600 mr-2"></i>신규 사업장 등록 및 관리번호 할당</h3>
                <button onclick="closeModal()" class="text-gray-400 hover:text-gray-700"><i class="fa-solid fa-times text-xl"></i></button>
            </div>
            <div class="p-6 overflow-y-auto space-y-8 bg-white">
                
                <!-- 상단: 불러오기 액션 -->
                <div class="flex justify-end">
                    <button class="text-xs border border-gray-300 px-3 py-1.5 rounded bg-white hover:bg-gray-50 flex items-center text-gray-700 font-bold shadow-sm">
                        <i class="fa-solid fa-download mr-1 text-blue-500"></i> 회사 마스터 정보 불러오기
                    </button>
                </div>

                <!-- 기본 정보 -->
                <div>
                    <h4 class="text-sm font-bold text-gray-900 border-l-4 border-gray-800 pl-2 mb-4">사업장 기본 정보</h4>
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="block text-xs font-bold text-gray-700 mb-1">사업장 관리 코드 (자체용)</label><input type="text" placeholder="예: WP-001" class="w-full border border-gray-300 rounded px-3 py-2 text-sm"></div>
                        <div><label class="block text-xs font-bold text-gray-700 mb-1">사업장명 <span class="text-red-500">*</span></label><input type="text" placeholder="예: 부산 공장" class="w-full border border-gray-300 rounded px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500"></div>
                        
                        <div><label class="block text-xs font-bold text-gray-700 mb-1">사업자등록번호 <span class="text-red-500">*</span></label><input type="text" placeholder="회사 정보 연동됨" class="w-full border border-gray-300 rounded px-3 py-2 text-sm bg-gray-50 text-gray-500" readonly></div>
                        <div><label class="block text-xs font-bold text-gray-700 mb-1">법인등록번호 <span class="text-red-500">*</span></label><input type="text" placeholder="회사 정보 연동됨" class="w-full border border-gray-300 rounded px-3 py-2 text-sm bg-gray-50 text-gray-500" readonly></div>
                        
                        <div><label class="block text-xs font-bold text-gray-700 mb-1">업태 / 종목 <span class="text-red-500">*</span></label><input type="text" placeholder="회사 정보 연동됨" class="w-full border border-gray-300 rounded px-3 py-2 text-sm bg-gray-50 text-gray-500" readonly></div>
                        <div><label class="block text-xs font-bold text-gray-700 mb-1">개업연월일</label><input type="date" class="w-full border border-gray-300 rounded px-3 py-2 text-sm"></div>
                        
                        <div class="col-span-2"><label class="block text-xs font-bold text-gray-700 mb-1">사업기간 (세법상 사업 활동 기준) <span class="text-red-500">*</span></label><div class="flex items-center space-x-2"><input type="date" class="w-full border border-gray-300 rounded px-3 py-2 text-sm"><span class="text-gray-400">~</span><input type="date" class="w-full border border-gray-300 rounded px-3 py-2 text-sm text-gray-400" placeholder="종료일(선택)"></div></div>
                        
                        <div class="col-span-2"><label class="block text-xs font-bold text-gray-700 mb-1">사업장 주소 <span class="text-red-500">*</span></label><input type="text" placeholder="소재지 입력 (지방세 관할 기준)" class="w-full border border-gray-300 rounded px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500"></div>
                        
                        <div><label class="block text-xs font-bold text-gray-700 mb-1">사업장 전화번호 <span class="text-red-500">*</span></label><input type="text" placeholder="02-000-0000" class="w-full border border-gray-300 rounded px-3 py-2 text-sm"></div>
                        <div><label class="block text-xs font-bold text-gray-700 mb-1">사업장 FAX 번호</label><input type="text" placeholder="02-000-0000" class="w-full border border-gray-300 rounded px-3 py-2 text-sm"></div>
                    </div>
                </div>

                <!-- 사회보험 신고 정보 (강조) -->
                <div class="bg-blue-50 p-5 rounded-lg border border-blue-200">
                    <h4 class="text-sm font-bold text-blue-900 mb-4 flex items-center"><i class="fa-solid fa-shield-halved mr-2"></i>사회보험 신고 정보 (필수)</h4>
                    <div class="grid grid-cols-2 gap-5 mb-5">
                        <div>
                            <label class="block text-xs font-bold text-blue-800 mb-1">국민/건강 관리번호 <span class="text-red-500">*</span></label>
                            <input type="text" placeholder="사업자번호 + 0" class="w-full border border-blue-300 rounded px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-blue-800 mb-1">고용/산재 관리번호 <span class="text-red-500">*</span></label>
                            <input type="text" placeholder="본사와 요율 다를 시 분리" class="w-full border border-blue-300 rounded px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div class="col-span-2">
                            <label class="block text-xs font-bold text-blue-800 mb-2">사업장 특이사항 (정부지원 및 특수직종)</label>
                            <div class="grid grid-cols-2 gap-3 bg-white p-3 rounded border border-blue-100">
                                <div><input type="text" placeholder="일자리 관리번호 입력" class="w-full border border-gray-300 rounded px-2 py-1.5 text-xs"></div>
                                <div><input type="text" placeholder="플랫폼사업자 이용개시번호" class="w-full border border-gray-300 rounded px-2 py-1.5 text-xs"></div>
                                <div class="flex items-center space-x-4 col-span-2 text-xs font-medium text-gray-700 mt-1">
                                    <label class="flex items-center cursor-pointer"><input type="checkbox" class="mr-1.5 rounded text-blue-600"> 예술인 사업장</label>
                                    <label class="flex items-center cursor-pointer"><input type="checkbox" class="mr-1.5 rounded text-blue-600"> 노무제공자(특고) 사업장</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 부가 정보 아코디언 -->
                <div class="border border-gray-200 rounded-lg overflow-hidden">
                    <button onclick="toggleAccordion('acc-wp-extra', 'icon-wp-extra')" class="w-full bg-gray-50 px-4 py-3 flex justify-between items-center hover:bg-gray-100 transition-colors">
                        <span class="font-bold text-sm text-gray-700">담당자, 대행기관 및 세무/계좌 정보 (선택)</span>
                        <i id="icon-wp-extra" class="fa-solid fa-chevron-down text-gray-500"></i>
                    </button>
                    <div id="acc-wp-extra" class="hidden p-5 bg-white space-y-6">
                        <div>
                            <h5 class="text-xs font-bold text-gray-500 mb-3">세무 및 환급 계좌</h5>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs text-gray-600 mb-1">사업장 세무서 코드 <span class="text-red-500">*</span></label>
                                    <input type="text" placeholder="관할 세무서 코드" class="w-full border border-gray-300 rounded px-3 py-2 text-sm">
                                </div>
                                <div>
                                    <label class="block text-xs text-gray-600 mb-1">환급 계좌 정보</label>
                                    <div class="flex space-x-2">
                                        <select class="w-1/3 border border-gray-300 rounded px-2 py-2 text-xs bg-white"><option>은행</option></select>
                                        <input type="text" placeholder="계좌번호" class="w-1/2 border border-gray-300 rounded px-2 py-2 text-xs">
                                        <input type="text" placeholder="예금주" class="w-1/4 border border-gray-300 rounded px-2 py-2 text-xs">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-6 border-t border-gray-100 pt-5">
                            <div>
                                <h5 class="text-xs font-bold text-gray-500 mb-3">내부 신고 담당자</h5>
                                <div class="space-y-3">
                                    <input type="text" placeholder="담당자명" class="w-full border border-gray-300 rounded px-3 py-2 text-sm">
                                    <input type="text" placeholder="휴대폰 번호" class="w-full border border-gray-300 rounded px-3 py-2 text-sm">
                                    <input type="text" placeholder="이메일 주소" class="w-full border border-gray-300 rounded px-3 py-2 text-sm">
                                </div>
                            </div>
                            <div>
                                <h5 class="text-xs font-bold text-gray-500 mb-3">보험사무대행기관 (위탁 시)</h5>
                                <div class="space-y-3">
                                    <div class="flex space-x-2">
                                        <input type="text" placeholder="대행기관번호" class="w-1/2 border border-gray-300 rounded px-3 py-2 text-sm">
                                        <input type="text" placeholder="대표자명" class="w-1/2 border border-gray-300 rounded px-3 py-2 text-sm">
                                    </div>
                                    <div class="flex space-x-2">
                                        <input type="text" placeholder="전화번호" class="w-1/2 border border-gray-300 rounded px-3 py-2 text-sm">
                                        <input type="text" placeholder="팩스 번호" class="w-1/2 border border-gray-300 rounded px-3 py-2 text-sm">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="px-6 py-4 bg-gray-50 border-t flex justify-end space-x-2">
                <button onclick="closeModal()" class="px-4 py-2 border border-gray-300 rounded-md text-sm font-bold text-gray-700 hover:bg-gray-100 bg-white">취소</button>
                <button onclick="closeModal()" class="px-6 py-2 bg-gray-800 text-white rounded-md text-sm font-bold hover:bg-gray-900 shadow-sm">사업장 등록</button>
            </div>
        </div>

        <!-- 3. 가족정보 관리 모달 -->
        <div id="modal-family" class="modal-content hidden bg-white w-full max-w-3xl rounded-xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
            <div class="px-6 py-4 border-b flex justify-between items-center bg-gray-50">
                <h3 class="font-bold text-lg"><i class="fa-solid fa-users text-blue-600 mr-2"></i>가족 및 피부양자 원장 관리</h3>
                <button onclick="closeModal()" class="text-gray-400 hover:text-gray-700"><i class="fa-solid fa-times text-xl"></i></button>
            </div>
            <div class="p-6 overflow-y-auto space-y-4">
                <div class="bg-yellow-50 border border-yellow-200 p-3 rounded text-sm text-yellow-800 mb-4 flex items-start">
                    <i class="fa-solid fa-circle-info mt-0.5 mr-2"></i><p>이곳에서 입력한 정보는 <b>연말정산 인적공제</b>와 <b>건강보험 피부양자 신고</b>의 공통 기준으로 활용됩니다.</p>
                </div>
                <div class="border border-gray-200 rounded-lg overflow-hidden">
                    <table class="w-full text-sm text-left">
                        <thead class="bg-gray-100 text-gray-600 font-bold border-b">
                            <tr><th class="px-4 py-3">관계</th><th class="px-4 py-3">성명</th><th class="px-4 py-3 text-center">연말정산 공제</th><th class="px-4 py-3 text-center">건강보험 피부양자</th></tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            <tr class="bg-blue-50">
                                <td class="px-4 py-3 font-medium text-gray-900">자녀</td>
                                <td class="px-4 py-3">이하은<br><span class="text-xs text-gray-500">240101-4XXXXXX</span></td>
                                <td class="px-4 py-3 text-center"><span class="text-green-600 font-bold">기본공제</span></td>
                                <td class="px-4 py-3 text-center">
                                    <div class="relative inline-block w-10 align-middle select-none">
                                        <input type="checkbox" checked class="toggle-checkbox absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer z-10 opacity-0"/>
                                        <label class="toggle-label block overflow-hidden h-5 rounded-full bg-gray-300 cursor-pointer relative"></label>
                                    </div>
                                    <p class="text-[10px] text-blue-600 font-bold mt-1">취득 신고 대상</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="px-6 py-4 bg-gray-50 border-t flex justify-end space-x-2">
                <button onclick="closeModal()" class="px-6 py-2 bg-gray-800 text-white rounded-md text-sm font-bold hover:bg-gray-900">닫기</button>
            </div>
        </div>

        <!-- 4. 변동사항 신고 모달 (Step 1: 종류 선택) -->
        <div id="modal-report-change" class="modal-content hidden bg-white w-full max-w-2xl rounded-xl shadow-2xl overflow-hidden">
            <div class="px-6 py-4 border-b flex justify-between items-center bg-gray-50">
                <h3 class="font-bold text-lg">어떤 자격 변동을 신고하시나요?</h3>
                <button onclick="closeModal()" class="text-gray-400 hover:text-gray-700"><i class="fa-solid fa-times text-xl"></i></button>
            </div>
            <div class="p-6 grid grid-cols-2 gap-4">
                <button onclick="closeModal()" class="flex flex-col text-left p-5 border border-gray-200 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition-all group opacity-50 cursor-not-allowed">
                    <div class="w-10 h-10 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mb-3"><i class="fa-solid fa-user-plus"></i></div>
                    <h4 class="font-bold text-gray-900 mb-1">자격 취득 신고</h4><p class="text-xs text-gray-500">신규 입사자의 4대보험 취득</p>
                </button>
                
                <!-- [액션 구현 부분] 이 버튼을 누르면 2단계 폼으로 넘어갑니다. -->
                <button onclick="openModal('modal-report-compensation')" class="flex flex-col text-left p-5 border border-green-500 bg-green-50 rounded-xl shadow-sm transition-all relative">
                    <span class="absolute top-3 right-3 flex h-3 w-3"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span><span class="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span></span>
                    <div class="w-10 h-10 bg-green-600 text-white rounded-full flex items-center justify-center mb-3"><i class="fa-solid fa-coins"></i></div>
                    <h4 class="font-bold text-gray-900 mb-1">보수월액 변경 신고</h4><p class="text-xs text-gray-500">연봉 계약 갱신에 따른 보험료 재산정</p>
                </button>
                
                <button onclick="closeModal()" class="flex flex-col text-left p-5 border border-gray-200 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition-all group opacity-50 cursor-not-allowed">
                    <div class="w-10 h-10 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mb-3"><i class="fa-solid fa-bed"></i></div>
                    <h4 class="font-bold text-gray-900 mb-1">휴직 및 납부예외 신고</h4><p class="text-xs text-gray-500">출산/육아, 병가 등 납부 유예 처리</p>
                </button>
                <button onclick="closeModal()" class="flex flex-col text-left p-5 border border-gray-200 rounded-xl hover:border-red-500 hover:bg-red-50 transition-all group opacity-50 cursor-not-allowed">
                    <div class="w-10 h-10 bg-red-100 text-red-600 rounded-full flex items-center justify-center mb-3"><i class="fa-solid fa-user-minus"></i></div>
                    <h4 class="font-bold text-gray-900 mb-1">자격 상실 신고</h4><p class="text-xs text-gray-500">퇴사 처리 및 이직확인서 발급</p>
                </button>
            </div>
        </div>

        <!-- 5. 보수월액 변경 신고 (Step 2: 실제 폼 모달) -->
        <div id="modal-report-compensation" class="modal-content hidden bg-white w-full max-w-2xl rounded-xl shadow-2xl overflow-hidden flex flex-col">
            <div class="px-6 py-4 border-b flex justify-between items-center bg-green-50">
                <h3 class="font-bold text-lg flex items-center"><i class="fa-solid fa-coins text-green-600 mr-2"></i>보수월액 변경 신고서 작성</h3>
                <button onclick="closeModal()" class="text-gray-400 hover:text-gray-700"><i class="fa-solid fa-times text-xl"></i></button>
            </div>
            <div class="p-6 overflow-y-auto space-y-6">
                <!-- 대상자 정보 자동 연동 확인 영역 -->
                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200 flex justify-between items-center">
                    <div>
                        <span class="text-xs font-bold text-gray-500">신고 대상자</span>
                        <p class="font-bold text-gray-900">이규리 <span class="text-sm font-normal text-gray-500 ml-1">900114-2XXXXXX</span></p>
                    </div>
                    <div class="text-right">
                        <span class="text-xs font-bold text-gray-500">기존 보수월액</span>
                        <p class="font-bold text-gray-400 line-through">4,500,000 원</p>
                    </div>
                </div>

                <!-- 필수 입력 폼 -->
                <div class="grid grid-cols-2 gap-5">
                    <div class="col-span-2">
                        <label class="block text-sm font-bold text-gray-700 mb-2">대상 공단 <span class="text-red-500">*</span></label>
                        <div class="flex space-x-4">
                            <label class="flex items-center space-x-2"><input type="checkbox" checked class="w-4 h-4 text-blue-600 rounded"><span>국민연금</span></label>
                            <label class="flex items-center space-x-2"><input type="checkbox" checked class="w-4 h-4 text-blue-600 rounded"><span>건강보험</span></label>
                            <label class="flex items-center space-x-2"><input type="checkbox" checked class="w-4 h-4 text-blue-600 rounded"><span>고용보험</span></label>
                            <label class="flex items-center space-x-2"><input type="checkbox" checked class="w-4 h-4 text-blue-600 rounded"><span>산재보험</span></label>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">변경 적용 연월 <span class="text-red-500">*</span></label>
                        <input type="month" value="2026-03" class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-green-500 text-gray-900 font-bold">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">보수 변경 사유 <span class="text-red-500">*</span></label>
                        <select class="w-full border border-gray-300 rounded-md px-3 py-2 text-sm bg-white focus:ring-2 focus:ring-green-500">
                            <option>1. 임금 인상</option>
                            <option>2. 임금 인하</option>
                            <option>3. 착오 정정</option>
                        </select>
                    </div>
                    <div class="col-span-2 relative">
                        <label class="block text-sm font-bold text-gray-700 mb-1">변경 후 보수월액 <span class="text-red-500">*</span></label>
                        <div class="flex items-center">
                            <input type="text" value="5,500,000" class="w-full border border-green-500 rounded-md px-3 py-2 text-lg font-bold text-blue-700 focus:outline-none focus:ring-2 focus:ring-green-500 pr-10">
                            <span class="absolute right-3 font-bold text-gray-500">원</span>
                        </div>
                        <p class="text-xs text-blue-600 mt-1"><i class="fa-solid fa-link mr-1"></i>급여 코어의 연봉계약 정보(5,500,000원)를 불러왔습니다.</p>
                    </div>
                </div>
            </div>
            <div class="px-6 py-4 bg-gray-50 border-t flex justify-between items-center">
                <button onclick="openModal('modal-report-change')" class="text-sm font-bold text-gray-500 hover:text-gray-800"><i class="fa-solid fa-arrow-left mr-1"></i> 뒤로가기</button>
                <div class="space-x-2">
                    <button onclick="closeModal()" class="px-4 py-2 border border-gray-300 rounded-md text-sm font-bold text-gray-700 hover:bg-gray-100 bg-white">취소</button>
                    <!-- 저장 버튼을 누르면 타임라인에 반영된다는 알림창(모의) -->
                    <button onclick="alert('EDI 신고 파일 생성이 완료되었으며, 변동사항 타임라인에 추가되었습니다.'); closeModal();" class="px-6 py-2 bg-green-600 text-white rounded-md text-sm font-bold hover:bg-green-700 shadow-sm">신고서 생성 및 타임라인 반영</button>
                </div>
            </div>
        </div>

        <!-- 6. 문서 다운로드 모달 -->
        <div id="modal-download" class="modal-content hidden bg-white w-full max-w-3xl rounded-xl shadow-2xl overflow-hidden flex flex-col h-[85vh]">
            <div class="px-6 py-4 border-b flex justify-between items-center bg-gray-800 text-white">
                <h3 class="font-bold text-lg flex items-center"><i class="fa-solid fa-file-pdf text-red-400 mr-2"></i> <span id="download-title">신고서 미리보기</span></h3>
                <div class="flex space-x-3">
                    <button class="text-sm font-bold bg-white text-gray-800 px-3 py-1.5 rounded hover:bg-gray-200 flex items-center"><i class="fa-solid fa-download mr-1.5"></i> EDI 텍스트 파일 생성</button>
                    <button onclick="closeModal()" class="text-gray-300 hover:text-white"><i class="fa-solid fa-times text-xl"></i></button>
                </div>
            </div>
            <div class="flex-1 bg-gray-300 p-8 overflow-y-auto flex justify-center">
                <div class="bg-white w-full max-w-2xl min-h-[800px] shadow-lg border border-gray-200 p-10 flex flex-col">
                    <div class="border-b-2 border-black pb-4 mb-6 text-center"><h1 id="doc-header" class="text-2xl font-black tracking-widest">신청서 서식</h1></div>
                    <div class="grid grid-cols-2 gap-y-4 text-sm border-t border-l border-black [&>div]:border-b [&>div]:border-r [&>div]:border-black [&>div]:p-2">
                        <div class="bg-gray-100 font-bold">사업장관리번호</div><div>123-45-67890-0</div>
                        <div class="bg-gray-100 font-bold">사업장 명칭</div><div>주식회사 플렉스 (본사)</div>
                        <div class="bg-gray-100 font-bold">성명</div><div>이규리</div>
                        <div class="bg-gray-100 font-bold">예외사유부호</div><div class="text-red-600 font-bold">01 (산전후휴가 및 육아휴직)</div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- UI Interactions Script -->
    <script>
        // 1. 탭 전환 로직 (모두 복구)
        function switchTab(tabId) {
            const tabs = ['company', 'workplace', 'member'];
            tabs.forEach(id => {
                const el = document.getElementById('tab-' + id);
                el.classList.add('hidden');
                el.classList.remove('block', 'flex'); 
            });

            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.className = "tab-btn flex items-center px-4 py-2 rounded-md text-sm font-medium transition-all text-gray-500 hover:text-gray-800 hover:bg-gray-200";
            });

            const activeEl = document.getElementById('tab-' + tabId);
            activeEl.classList.remove('hidden');
            if (tabId === 'member') activeEl.classList.add('flex');
            else activeEl.classList.add('block');
            
            const activeBtn = document.getElementById('btn-tab-' + tabId);
            activeBtn.className = "tab-btn flex items-center px-4 py-2 rounded-md text-sm font-bold transition-all bg-white text-blue-700 shadow-sm border border-gray-200";
        }

        // 2. 회사정보 법인/개인 분기 로직
        function toggleCorpType(type) {
            const lblCorp = document.getElementById('lbl-corp-corporate');
            const lblIndiv = document.getElementById('lbl-corp-individual');
            const fieldsCorp = document.getElementById('fields-corporate');
            const fieldsIndiv = document.getElementById('fields-individual');
            const title = document.getElementById('txt-corp-title');

            if (type === 'corporate') {
                lblCorp.className = "flex items-center p-3 border rounded-md cursor-pointer flex-1 justify-center transition-colors bg-blue-600 text-white border-blue-600 shadow-sm";
                lblIndiv.className = "flex items-center p-3 border rounded-md cursor-pointer flex-1 justify-center transition-colors bg-white text-gray-600 hover:bg-gray-50 border-gray-300";
                fieldsCorp.classList.remove('hidden'); fieldsCorp.classList.add('grid');
                fieldsIndiv.classList.add('hidden');
                title.innerText = "법인 사업자 전용 정보";
            } else {
                lblIndiv.className = "flex items-center p-3 border rounded-md cursor-pointer flex-1 justify-center transition-colors bg-blue-600 text-white border-blue-600 shadow-sm";
                lblCorp.className = "flex items-center p-3 border rounded-md cursor-pointer flex-1 justify-center transition-colors bg-white text-gray-600 hover:bg-gray-50 border-gray-300";
                fieldsIndiv.classList.remove('hidden');
                fieldsCorp.classList.add('hidden'); fieldsCorp.classList.remove('grid');
                title.innerText = "개인 사업자 전용 정보";
            }
        }

        function toggleJointBusiness() {
            const isChecked = document.getElementById('toggle-joint').checked;
            const fields = document.getElementById('fields-joint-business');
            if(isChecked) fields.classList.remove('hidden');
            else fields.classList.add('hidden');
        }

        // 3. 아코디언 및 서브탭 로직
        function toggleAccordion(contentId, iconId) {
            const content = document.getElementById(contentId);
            const icon = document.getElementById(iconId);
            
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                icon.classList.remove('fa-chevron-down'); icon.classList.add('fa-chevron-up');
            } else {
                content.classList.add('hidden');
                icon.classList.remove('fa-chevron-up'); icon.classList.add('fa-chevron-down');
            }
        }
        
        function switchMemberSubTab(viewId) {
            const btnStatus = document.getElementById('sub-tab-status');
            const btnTimeline = document.getElementById('sub-tab-timeline');
            const viewStatus = document.getElementById('member-view-status');
            const viewTimeline = document.getElementById('member-view-timeline');

            if(viewId === 'status') {
                btnStatus.className = "pb-3 border-b-2 font-bold text-blue-600 border-blue-600 transition-colors pt-3";
                btnTimeline.className = "pb-3 border-b-2 font-medium text-gray-500 border-transparent hover:text-gray-800 transition-colors pt-3";
                viewStatus.classList.remove('hidden');
                viewTimeline.classList.add('hidden');
            } else {
                btnTimeline.className = "pb-3 border-b-2 font-bold text-blue-600 border-blue-600 transition-colors pt-3";
                btnStatus.className = "pb-3 border-b-2 font-medium text-gray-500 border-transparent hover:text-gray-800 transition-colors pt-3";
                viewTimeline.classList.remove('hidden');
                viewStatus.classList.add('hidden');
            }
        }

        // 4. 모달 관리 로직
        function openModal(modalId, contextStr = null) {
            document.getElementById('modal-backdrop').classList.remove('hidden');
            document.querySelectorAll('.modal-content').forEach(el => el.classList.add('hidden'));
            document.getElementById(modalId).classList.remove('hidden');
            
            // PDF 다운로드 모달의 경우 문서명 변경 처리
            if (modalId === 'modal-download' && contextStr) {
                document.getElementById('download-title').innerText = contextStr + ' 미리보기';
                document.getElementById('doc-header').innerText = contextStr;
            }
        }

        function closeModal() {
            document.getElementById('modal-backdrop').classList.add('hidden');
        }
        
        // 초기 렌더링 세팅
        document.addEventListener('DOMContentLoaded', () => { 
            // 구성을 명확히 보여주기 위해 1.회사 정보 탭으로 시작합니다. (우측 상단 탭 클릭하여 이동 가능)
            switchTab('member'); 
        });
    </script>
</body>
</html>